<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="Template" language="groovy" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="f33557b4-8855-4bf5-b73c-6a798e382634">
	<property name="ireport.zoom" value="1.1586575189468005"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<style name="FBold" fill="Solid" hAlign="Left" vAlign="Top" fontName="TH SarabunPSK" fontSize="14" isBold="true" pdfFontName="THSarabun Bold.ttf" pdfEncoding="Identity-H"/>
	<style name="Rpt" fontName="TH SarabunPSK" fontSize="10" pdfFontName="THSarabun.ttf" pdfEncoding="Identity-H"/>
	<style name="Default" isDefault="true" fontName="TH SarabunPSK" fontSize="14" pdfFontName="THSarabun.ttf" pdfEncoding="Identity-H"/>
	<style name="Symbol" fontName="Wingdings 2" isBold="true" pdfFontName="Wingdings 2"/>
	<parameter name="PUBLISHER" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["พงศ์ปณต ทัศนียาชุมพาลี"]]></defaultValueExpression>
	</parameter>
	<parameter name="DATE_CURRENT" class="java.util.Date" isForPrompting="false">
		<defaultValueExpression><![CDATA[new Date()]]></defaultValueExpression>
	</parameter>
	<parameter name="FUND_NAME_START" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["-"]]></defaultValueExpression>
	</parameter>
	<parameter name="PERIOD_ID" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["-"]]></defaultValueExpression>
	</parameter>
	<parameter name="FACULTY_NAME" class="java.lang.String">
		<parameterDescription><![CDATA["-"]]></parameterDescription>
		<defaultValueExpression><![CDATA["-"]]></defaultValueExpression>
	</parameter>
	<parameter name="PLAN_NAME_START" class="java.lang.String">
		<parameterDescription><![CDATA["-"]]></parameterDescription>
		<defaultValueExpression><![CDATA["-"]]></defaultValueExpression>
	</parameter>
	<parameter name="PLAN_NAME_END" class="java.lang.String">
		<parameterDescription><![CDATA["-"]]></parameterDescription>
		<defaultValueExpression><![CDATA["-"]]></defaultValueExpression>
	</parameter>
	<parameter name="FUND_NAME_END" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["-"]]></defaultValueExpression>
	</parameter>
	<parameter name="HEAD_RPT" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["หน่วยงาน"+$P{FACULTY_NAME}+"\n คำชี้แจงงบประมาณรายจ่ายเงินรายได้ประจำปีงบประมาณ พ.ศ."+$P{PERIOD_ID}+" \n จำแนกตาม แผนงาน/กองทุน/หมวดรายจ่าย"]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[-- รายงานแบบ ร.3
select
	bgType.bgTypeMasterId, bgType.bgTypeMasterName,
	bgType.bgTypeMainId, bgType.bgTypeMainName,
	bgType.bgTypeSubId, bgType.bgTypeSubName,
	bg.deptId, bg.deptName,
	bg.planId, bg.planName,
	bg.fundgroupId, bg.fundgroupName,
	bg.budgetSummary
from (
	select
		bgTypeTmp.bgTypeMasterId, bgTypeTmp.bgTypeMasterName,
		bgTypeTmp.bgTypeMainId, bgTypeTmp.bgTypeMainName,
		bgTypeTmp.bgTypeId, bgTypeTmp.bgTypeName,
		case when bgTypeTmp.bgTypeSubId is not null then bgTypeTmp.bgTypeSubId else bgTypeTmp.bgTypeId end as bgTypeSubId,
		case when bgTypeTmp.bgTypeSubName is not null then bgTypeTmp.bgTypeSubName else bgTypeTmp.bgTypeName end as bgTypeSubName
	from (
		select
		bgTypeMaster.BUDGETTYPEID as bgTypeMasterId, bgTypeMaster.BUDGETTYPENAME as bgTypeMasterName,
		bgTypeMain.BUDGETTYPEID as bgTypeMainId, bgTypeMain.BUDGETTYPENAME as bgTypeMainName,
		case when bgType.BUDGETTYPEID is not null then bgType.BUDGETTYPEID else bgTypeMain.BUDGETTYPEID end as bgTypeId,
		case when bgType.BUDGETTYPENAME is not null then bgType.BUDGETTYPENAME else bgTypeMain.BUDGETTYPENAME end as bgTypeName,
		bgTypeSub.BUDGETTYPEID as bgTypeSubId, bgTypeSub.BUDGETTYPENAME as bgTypeSubName
		from BUDGETTYPE bgTypeMaster
		left outer join BUDGETTYPE bgTypeMain on bgTypeMaster.BUDGETTYPEID = bgTypeMain.MASTERID
		left outer join BUDGETTYPE bgType on bgTypeMain.BUDGETTYPEID = bgType.MASTERID
		left outer join BUDGETTYPE bgTypeSub on bgType.BUDGETTYPEID = bgTypeSub.MASTERID
		where bgTypeMaster.MASTERID = 0
		and bgTypeMaster.BUDGETTYPECODE = 'K'
		and bgTypeMain.BUDGETTYPECODE = 'K'
	) bgTypeTmp
) bgType
inner join BUDGETREVENUE bgr on bgr.BUDGETTYPEID = bgType.bgTypeSubId
left outer join (
	select
		bgh.DEPARTMENTID as deptId, dept.DEPARTMENTNAME as deptName,
		bgh.L3D_PLANID as planId, l3dPlan.PLANNAME as planName,
		bgh.FUNDGROUPID as fundgroupId, fund.FUNDGROUPNAME as fundgroupName,
		rv.BUDGETTYPEID as budgetTypeId,
		coalesce(sum(rv.BUDGETAMOUNT), 0) as budgetSummary
	from BUDGETHEAD bgh
	left outer join BUDGETREVENUE rv on rv.BUDGETHEADID = bgh.BUDGETHEADID
	inner join L3D_PLAN l3dPlan on l3dPlan.PLANID = bgh.L3D_PLANID
	inner join L3D_DEPARTMENT dept on bgh.DEPARTMENTID = dept.DEPARTMENTID
	inner join L3D_FUNDGROUP fund on fund.FUNDGROUPID = bgh.FUNDGROUPID
	where bgh.BUDGETTYPECODE = 'K'
	--and bgh.BUDGETPERIODID = 2558
	--and bgh.DEPARTMENTID = 10102
	--and bgh.FUNDGROUPID = 100
	--and bgh.L3D_PLANID = 10
	group by bgh.DEPARTMENTID, dept.DEPARTMENTNAME, bgh.L3D_PLANID, l3dPlan.PLANNAME, bgh.FUNDGROUPID, fund.FUNDGROUPNAME, rv.BUDGETTYPEID
) bg on bg.budgetTypeId = bgType.bgTypeSubId
group by bg.deptId, bg.deptName,
	bg.planId, bg.planName,
	bg.fundgroupId, bg.fundgroupName,
	bgType.bgTypeMasterId, bgType.bgTypeMasterName,
	bgType.bgTypeMainId, bgType.bgTypeMainName,
	bgType.bgTypeId, bgType.bgTypeName,
	bgType.bgTypeSubId, bgType.bgTypeSubName,
	bg.budgetSummary]]>
	</queryString>
	<field name="bgTypeMasterId" class="java.lang.Integer"/>
	<field name="bgTypeMasterName" class="java.lang.String"/>
	<field name="bgTypeMainId" class="java.lang.Integer"/>
	<field name="bgTypeMainName" class="java.lang.String"/>
	<field name="bgTypeSubId" class="java.lang.Integer"/>
	<field name="bgTypeSubName" class="java.lang.String"/>
	<field name="deptId" class="java.lang.Integer"/>
	<field name="deptName" class="java.lang.String"/>
	<field name="planId" class="java.lang.Integer"/>
	<field name="planName" class="java.lang.String"/>
	<field name="fundgroupId" class="java.lang.Integer"/>
	<field name="fundgroupName" class="java.lang.String"/>
	<field name="budgetSummary" class="java.math.BigDecimal"/>
	<variable name="CURRENT_PAGE" class="java.lang.Integer" resetType="None" calculation="DistinctCount">
		<variableExpression><![CDATA[$V{PAGE_NUMBER}]]></variableExpression>
		<initialValueExpression><![CDATA[new Integer(1)]]></initialValueExpression>
	</variable>
	<variable name="CURRENT_DATE" class="java.util.Date">
		<variableExpression><![CDATA[new Date()]]></variableExpression>
	</variable>
	<variable name="total" class="java.math.BigDecimal" calculation="Sum">
		<variableExpression><![CDATA[$F{budgetSummary}]]></variableExpression>
	</variable>
	<group name="G1">
		<groupExpression><![CDATA[$F{bgTypeMasterId}]]></groupExpression>
		<groupHeader>
			<band height="20">
				<textField>
					<reportElement style="FBold" x="0" y="0" width="428" height="20" uuid="814e30bc-89d2-4e5d-a57e-94d80c1c0ced"/>
					<box leftPadding="2">
						<leftPen lineWidth="0.75"/>
						<rightPen lineWidth="0.75"/>
					</box>
					<textFieldExpression><![CDATA[$F{bgTypeMasterName}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="428" y="0" width="127" height="20" uuid="6327e7fe-b7a0-468a-99ff-20001a374f83"/>
					<box>
						<rightPen lineWidth="0.75"/>
					</box>
					<text><![CDATA[]]></text>
				</staticText>
			</band>
		</groupHeader>
	</group>
	<group name="G2">
		<groupExpression><![CDATA[$F{bgTypeSubId}]]></groupExpression>
		<groupHeader>
			<band height="20">
				<textField>
					<reportElement x="0" y="0" width="428" height="20" uuid="474f6dd4-89c7-4ffa-9e06-0669329c3626"/>
					<box leftPadding="15">
						<leftPen lineWidth="0.75"/>
						<rightPen lineWidth="0.75"/>
					</box>
					<textFieldExpression><![CDATA[$F{bgTypeSubName}]]></textFieldExpression>
				</textField>
				<staticText>
					<reportElement x="428" y="0" width="127" height="20" uuid="7f7724f0-2eb0-4028-9dd4-e0d67a5c97fc"/>
					<box>
						<rightPen lineWidth="0.75"/>
					</box>
					<text><![CDATA[]]></text>
				</staticText>
			</band>
		</groupHeader>
	</group>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band splitType="Stretch"/>
	</title>
	<pageHeader>
		<band height="49" splitType="Stretch">
			<textField isStretchWithOverflow="true">
				<reportElement style="FBold" stretchType="RelativeToBandHeight" x="0" y="20" width="555" height="20" uuid="553b4433-cefd-4c7b-a74b-8feabdac7852"/>
				<textElement textAlignment="Center">
					<font size="16"/>
				</textElement>
				<textFieldExpression><![CDATA[$P{HEAD_RPT}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement style="FBold" x="0" y="0" width="555" height="20" uuid="cf10a633-0432-4c0c-a97d-a4a822dacd93"/>
				<textElement textAlignment="Right"/>
				<textFieldExpression><![CDATA["แบบ ร.3"]]></textFieldExpression>
			</textField>
		</band>
	</pageHeader>
	<columnHeader>
		<band height="60" splitType="Stretch">
			<textField>
				<reportElement style="FBold" x="0" y="0" width="428" height="20" uuid="cbed7b31-88b1-487f-88a7-07bfa054aed5"/>
				<box>
					<topPen lineWidth="0.75"/>
					<leftPen lineWidth="0.75"/>
					<bottomPen lineWidth="0.75"/>
					<rightPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA["แผนงาน/กองทุน/หมวดรายจ่าย"]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement style="FBold" x="428" y="0" width="127" height="20" uuid="7b0f1ba4-5f5c-435d-a4fa-e3aca1fbe52c"/>
				<box>
					<topPen lineWidth="0.75"/>
					<leftPen lineWidth="0.75"/>
					<bottomPen lineWidth="0.75"/>
					<rightPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA["งบประมาณ"]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement style="FBold" x="0" y="20" width="428" height="20" uuid="d090d698-dabf-446b-b2c3-7d9013f05608"/>
				<box leftPadding="2">
					<leftPen lineWidth="0.75"/>
					<rightPen lineWidth="0.75"/>
				</box>
				<textFieldExpression><![CDATA["แผนงาน : "+$P{PLAN_NAME_START}+" - "+$P{PLAN_NAME_END}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement style="FBold" x="0" y="40" width="428" height="20" uuid="bd5191a5-20ea-4f76-8071-9af7b0dd2de7"/>
				<box leftPadding="2">
					<leftPen lineWidth="0.75"/>
					<bottomPen lineWidth="0.75"/>
					<rightPen lineWidth="0.75"/>
				</box>
				<textFieldExpression><![CDATA["กองทุน : "+$P{FUND_NAME_START}+" - "+$P{FUND_NAME_END}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="428" y="20" width="127" height="20" uuid="38f5f9fa-880e-4195-93a8-a60795d0de49"/>
				<box>
					<rightPen lineWidth="0.75"/>
				</box>
				<text><![CDATA[]]></text>
			</staticText>
			<textField evaluationTime="Report" pattern="#,###">
				<reportElement style="FBold" x="428" y="40" width="127" height="20" uuid="aae2a911-1050-484a-8fbd-6118124ad380"/>
				<box rightPadding="2">
					<bottomPen lineWidth="0.75"/>
					<rightPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Right"/>
				<textFieldExpression><![CDATA[$V{total}]]></textFieldExpression>
			</textField>
		</band>
	</columnHeader>
	<detail>
		<band height="20" splitType="Stretch">
			<textField>
				<reportElement x="0" y="0" width="428" height="20" uuid="04025943-2bd5-4e7b-b941-cfd508c1c70c"/>
				<box leftPadding="30">
					<leftPen lineWidth="0.75"/>
					<rightPen lineWidth="0.75"/>
				</box>
				<textFieldExpression><![CDATA[$F{deptName}]]></textFieldExpression>
			</textField>
			<textField pattern="#,###">
				<reportElement style="FBold" x="428" y="0" width="127" height="20" uuid="c2e92ef3-ab99-46ed-a1c4-7f39981cc36a"/>
				<box rightPadding="2">
					<rightPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Right">
					<font size="14"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{budgetSummary}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
	<columnFooter>
		<band splitType="Stretch"/>
	</columnFooter>
	<pageFooter>
		<band height="32" splitType="Stretch">
			<textField pattern="dd/MM/yyyy HH:mm:ss">
				<reportElement x="0" y="20" width="555" height="12" uuid="6c13bc20-06bd-4a29-b6b1-b74bcef75220"/>
				<textElement verticalAlignment="Bottom">
					<font size="10"/>
				</textElement>
				<textFieldExpression><![CDATA["วันที่พิมพ์ : "+$V{CURRENT_DATE}]]></textFieldExpression>
			</textField>
		</band>
	</pageFooter>
	<summary>
		<band height="30" splitType="Stretch">
			<textField>
				<reportElement style="FBold" x="0" y="0" width="428" height="20" uuid="88b3c6ba-1ee5-436f-88c5-93bbf0bbd2ef"/>
				<box>
					<topPen lineWidth="0.75"/>
					<leftPen lineWidth="0.75"/>
					<bottomPen lineWidth="0.75"/>
					<rightPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Center" verticalAlignment="Middle"/>
				<textFieldExpression><![CDATA["รวม"]]></textFieldExpression>
			</textField>
			<textField pattern="#,###">
				<reportElement style="FBold" x="428" y="0" width="127" height="20" uuid="77257dd8-afcd-4373-a3b0-f848697fd19c"/>
				<box rightPadding="2">
					<topPen lineWidth="0.75"/>
					<bottomPen lineWidth="0.75"/>
					<rightPen lineWidth="0.75"/>
				</box>
				<textElement textAlignment="Right"/>
				<textFieldExpression><![CDATA[$V{total}]]></textFieldExpression>
			</textField>
		</band>
	</summary>
</jasperReport>
